<html>

<body>
  <h1>Testing Crypto Subtle</h1>
  <label for="toEncrypt">To Encrypt</label>
  <br />
  <input id="toEncrypt" type="text" name="toEncrypt" value="" />
  <button id="testEncryption" type="submit">Test Encryption</button>
  <br />
  <label for="encrypted"">Encrypted</label>
  <br/>
  <textarea id="encrypted" rows="13" cols="100"></textarea>
  <br/>
  <br/>
  <br/>
  <br/>
  <label for="encrypted"">Decrypted</label>
  <button id="testDecryption" type="submit">Test Decryption</button>
  <br/>
  <br/>
  <textarea id="decrypted" rows="13" cols="100"></textarea>
  <br/>
  <br/>
    <script>
      // xxxxxxxxxxxxx Credentials xxxxxxxxxxxxx
      const rsaAsymmerticPublicKey = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0iEqfpLmo987S7Hhsd2blxqGYDf5YPphgE5YtU2mINfsObPRi3h5crxtjh8ADHASljOc9ajKLPJpen9PB+qqd7jZgfIf1+CI/oRKPW1ny71z4KO4PNXKqTIwP/cFvhQXzh6+PSPRHBlKIzPbu84fK7opurqNcndx2OLQiFHbpQMrUz++uEvJ5N99kMGLX6WUnDL8QEwo7t/zer/kxlL1ULLrn6vycBhhrOpO8FiLpL2jp+oixGj5AkqHcHihUGfqm0fAV5lgiwAZNW3X72qJFbp7ot5etcmhScwxzw0irPiMq7G5/NFC7JKPNORwtUBUV6V1acW98JAGxngDe7zksQIDAQAB"
      const privateKey =
        `-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDSISp+kuaj3ztL
seGx3ZuXGoZgN/lg+mGATli1TaYg1+w5s9GLeHlyvG2OHwAMcBKWM5z1qMos8ml6
f08H6qp3uNmB8h/X4Ij+hEo9bWfLvXPgo7g81cqpMjA/9wW+FBfOHr49I9EcGUoj
M9u7zh8ruim6uo1yd3HY4tCIUdulAytTP764S8nk332QwYtfpZScMvxATCju3/N6
v+TGUvVQsuufq/JwGGGs6k7wWIukvaOn6iLEaPkCSodweKFQZ+qbR8BXmWCLABk1
bdfvaokVunui3l61yaFJzDHPDSKs+Iyrsbn80ULsko805HC1QFRXpXVpxb3wkAbG
eAN7vOSxAgMBAAECggEAaGswybtIP5Czz5aymAeOxNTah7/o/ccOYosMS/QtJM8H
xVjVPWB9wYVfT6uaA5RBuEAntG/PH+zKe6P96uozEdFazNc7+bPLf+bPWZ0fYkBf
7/aLnDeFQPT+wxqG0QD9H2FpmcpNpI/wpnOjsrzoAnu9NtxzY7l1apizlbpP0rxM
jr4v1ng5OZKaqLxpqhST26oqa6pAXxqzvSMm67CBvtctrwMk7u/PosLRQefEY3E1
mhVD2zCl25GGnJzb6K00WS3dCxKXYea6bBsAS5mVGgxx7X7j/XpIayGwD7SkbZWQ
4RjRvcYZ+BpozuEhNQQFoLQpYydSrOkcEpmvcmJ+vQKBgQD1dQ2LxhIoivXWsDME
aMONNOPEdtAao4lJ90BJSdSPCUMFFFw1L/UFETU23f1kZMFcTlVd0RRqZKhoGhDS
V+qki5ZHqJVuM6oIqoYQRrB4ZvdMwG76IPuHo/mNOIg6CkbfRrqCycuTDKW5EhJp
jxXF36k/6fuKP4d7UpLo0nw3RwKBgQDbJ6oUCF5Hgz7mR2/wIQm942IBHfljB7BI
j5LJfQxqaz5Hk0ygeMjTSu9Zg60NRMSX0VseixvjiIw+n0FDZj9m2mtkMPa8sBk6
XOi0TyOhDDLQOekewm0xrrxtUPA86JNs9nZLEwvJ+H6pTde15knKOl/h1cfQSHbE
kisghlHwRwKBgBHRBkOwA99nfsKvlXRrek5EmYfILADTAAMbbFIlhsU/Ids7iBng
OkO85QTvhhYEbjiaAv5FT9sNJWAxDCmIciKxcx4OcZJHM79fSU3jI6oJp0et7CBB
xqAo2dNTWCgGWPCZ/K3DogAxedH+KtH4rdboDivyeuylAduEud8mcBe/AoGBAKtz
GWy4q0FZHTE8fAcpYZyrsfVbxMnDrxblM5nr+XWb1spaI117gOlEO4IVMKIrxX1c
LOP1Qmk8XzNylbUr3bgScmecors1LVdqbib5rs8EYxBh7c3Bn3l50THYW0nbTdK1
8g+Do/prLHQ5UOOeeOX7yx07iSmaN0hLbe/xBVNrAoGAND5WL7JZjljl0vBQxNZu
HNY5qTsTV5j09eNe4RF4K1ZluSI5Z1OB44Jqy9/5VgZIq1cKFygenZtH+sYOPdEt
HAxb1xrO1x41FibXTGWajvh6mlzVvA510C0luUpN+sBQSKxvJJ791tL7Or4q7h9y
phhoFahYXZl6Xk/D3v7Cmno=
-----END PRIVATE KEY-----`;
      // xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

      // Utils
      const toArrayBuffer = (str) => {
        const buf = new ArrayBuffer(str.length);
        const bufView = new Uint8Array(buf);
        for (let i = 0; i < str.length; i++) {
          bufView[i] = str.charCodeAt(i);
        }
        return buf;
      };

      function getPkcs8Der(pkcs8Pem) {
        const pemHeader = "-----BEGIN PRIVATE KEY-----";
        const pemFooter = "-----END PRIVATE KEY-----";
        var pemContents = pkcs8Pem.substring(pemHeader.length, pkcs8Pem.length - pemFooter.length);
        var binaryDerString = window.atob(pemContents);
        return toArrayBuffer(binaryDerString);
      }

      const toBase64Encode = (arrayBuffer) => window.btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));

      const asymmetricallEncrypt = async (base64PubKey, sourceString) => {
        const keyBuf = toArrayBuffer(window.atob(base64PubKey));
        const pubKeyDer = await window.crypto.subtle.importKey("spki", keyBuf, {name: "RSA-OAEP", hash: "SHA-256", }, true, ["encrypt"]);
        const encryptedBlock = await window.crypto.subtle.encrypt({name: "RSA-OAEP"}, pubKeyDer, new TextEncoder().encode(sourceString));
        console.log(encryptedBlock)
        return toBase64Encode(encryptedBlock);
      };

      const asymetricalDecrypt = async (base64PrivateKey, encrypted) => {
        const importedKey = await window.crypto.subtle.importKey("pkcs8", getPkcs8Der(base64PrivateKey), {name: "RSA-OAEP", hash: "SHA-256", }, true, ["decrypt"]);
        const decrypted = await window.crypto.subtle.decrypt({name: "RSA-OAEP"}, importedKey, toArrayBuffer(window.atob(encrypted)));

        console.log(new TextDecoder("utf-8").decode(decrypted));
        return (new TextDecoder("utf-8").decode(decrypted));
      }

      window.addEventListener("load", () => {
        document.getElementById("testEncryption").addEventListener("click", async () => {
          const encryptionBlock = await asymmetricallEncrypt(rsaAsymmerticPublicKey, document.getElementById('toEncrypt').value);
          document.getElementById('encrypted').value = encryptionBlock;
        });

        document.getElementById("testDecryption").addEventListener("click", async () => {
          document.getElementById('decrypted').value = await asymetricalDecrypt(privateKey, document.getElementById('encrypted').value);
        });
      });
    </script>
</body>

</html>
